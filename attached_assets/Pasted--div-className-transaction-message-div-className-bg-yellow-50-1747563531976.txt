<div className="transaction-message">
                                  <div className="bg-yellow-50 border border-yellow-100 rounded-lg p-4 w-full">
                                    <div className="text-lg font-bold mb-2">Confirm Purchase</div>
                                    
                                    {msg.product && (
                                      <div className="flex items-start mb-3">
                                        {/* Product Image */}
                                        <div className="h-16 w-16 rounded-md overflow-hidden bg-muted mr-3 flex-shrink-0">
                                          <img
                                            src={
                                              msg.product.imageUrl
                                                ? msg.product.imageUrl.startsWith('/api/images/')
                                                  ? msg.product.imageUrl
                                                  : `/api/images/${msg.product.imageUrl}`
                                                : "/placeholder.jpg"
                                            }
                                            alt={msg.product.name}
                                            onError={(e) => {
                                              (e.target as HTMLImageElement).src = "/placeholder.jpg";
                                            }}
                                            className="w-full h-full object-cover"
                                          />
                                        </div>
                                        
                                        {/* Product Details */}
                                        <div className="flex-grow">
                                          <div className="font-medium text-base">{msg.product.name}</div>
                                          {msg.product.price && (
                                            <div className="text-sm font-medium text-green-700">
                                              ${Number(msg.product.price).toFixed(2)}
                                            </div>
                                          )}
                                        </div>
                                      </div>
                                    )}
                                    
                                    {/* Only show confirm button to the receiver (buyer) */}
                                    {msg.receiverId === user?.id && !msg.isClicked && (
                                      <Button 
                                        className="w-full"
                                        onClick={() => handleConfirmPurchase(msg.id)}
                                      >
                                        Confirm Purchase
                                      </Button>
                                    )}
                                    
                                    {/* Show status when already clicked */}
                                    {msg.isClicked && (
                                      <div className="text-green-600 text-sm mt-1">
                                        âœ“ Purchase confirmed
                                      </div>
                                    )}
                                  </div>
                                </div>